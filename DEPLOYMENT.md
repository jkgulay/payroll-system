# Deployment Guide: Payroll System

## Frontend Deployment (Vercel)

### Prerequisites

- Vercel account (https://vercel.com)
- GitHub repository (recommended) or Vercel CLI

### Steps:

#### Option 1: Deploy via Vercel Dashboard (Recommended)

1. **Push code to GitHub**

   ```bash
   cd frontend
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-github-repo-url>
   git push -u origin main
   ```

2. **Import to Vercel**

   - Go to https://vercel.com/new
   - Import your GitHub repository
   - Select the `frontend` directory as root
   - Vercel will auto-detect Vite configuration

3. **Configure Environment Variables**

   - In Vercel dashboard → Settings → Environment Variables
   - Add:
     ```
     VITE_API_BASE_URL=https://your-railway-backend.railway.app/api
     ```

4. **Deploy**
   - Click "Deploy"
   - Vercel will build and deploy automatically

#### Option 2: Deploy via Vercel CLI

1. **Install Vercel CLI**

   ```bash
   npm install -g vercel
   ```

2. **Login to Vercel**

   ```bash
   vercel login
   ```

3. **Deploy**

   ```bash
   cd frontend
   vercel
   ```

4. **Set Environment Variables**

   ```bash
   vercel env add VITE_API_BASE_URL
   # Enter your Railway backend URL when prompted
   ```

5. **Deploy to Production**
   ```bash
   vercel --prod
   ```

---

## Backend Deployment (Railway)

### Prerequisites

- Railway account (https://railway.app)
- GitHub repository (recommended) or Railway CLI
- **PHP 8.2+** (Railway auto-detects from composer.json)

### Steps:

#### Option 1: Deploy via Railway Dashboard (Recommended)

1. **Push code to GitHub** (if not already done)

   ```bash
   cd backend
   git init
   git add .
   git commit -m "Initial backend commit"
   git remote add origin <your-github-repo-url>
   git push -u origin main
   ```

2. **Create New Project on Railway**

   - Go to https://railway.app/new
   - Click "Deploy from GitHub repo"
   - Select your repository
   - Railway will auto-detect the Laravel app in `backend/` directory via `nixpacks.toml`

3. **Add PostgreSQL Database**

   - In your Railway project, click "+ New"
   - Select "Database" → "PostgreSQL"
   - Railway will automatically create a database and set DATABASE_URL

4. **Configure Environment Variables**

   - In Railway dashboard → Variables tab
   - Add the following variables:

   ```
   APP_NAME="Payroll System"
   APP_ENV=production
   APP_DEBUG=false
   APP_URL=https://your-railway-backend.railway.app

   # Database (auto-generated by Railway, verify these exist)
   DB_CONNECTION=pgsql
   DATABASE_URL=<auto-generated by Railway>

   # Generate new key: php artisan key:generate --show
   APP_KEY=base64:your-generated-key-here

   # CORS - Add your Vercel frontend URL
   FRONTEND_URL=https://your-app.vercel.app
   SESSION_DOMAIN=.railway.app
   SANCTUM_STATEFUL_DOMAINS=your-app.vercel.app

   # Session & Cache
   SESSION_DRIVER=database
   CACHE_DRIVER=database
   QUEUE_CONNECTION=database

   # File Storage
   FILESYSTEM_DISK=public

   # Mail (optional - configure if needed)
   MAIL_MAILER=smtp
   MAIL_HOST=smtp.gmail.com
   MAIL_PORT=587
   MAIL_USERNAME=your-email@gmail.com
   MAIL_PASSWORD=your-app-password
   MAIL_ENCRYPTION=tls
   MAIL_FROM_ADDRESS=your-email@gmail.com
   MAIL_FROM_NAME="${APP_NAME}"
   ```

5. **Deploy**

   - Railway will automatically build and deploy
   - Monitor the deployment logs

6. **Run Initial Setup** (via Railway CLI or dashboard)

   ```bash
   # Install Railway CLI
   npm install -g @railway/cli

   # Login
   railway login

   # Link to your project
   railway link

   # Run migrations
   railway run php artisan migrate --force

   # Seed database (optional)
   railway run php artisan db:seed --force
   ```

#### Option 2: Deploy via Railway CLI

1. **Install Railway CLI**

   ```bash
   npm install -g @railway/cli
   ```

2. **Login and Initialize**

   ```bash
   cd backend
   railway login
   railway init
   ```

3. **Add PostgreSQL**

   ```bash
   railway add --database postgresql
   ```

4. **Set Environment Variables**

   ```bash
   railway variables set APP_NAME="Payroll System"
   railway variables set APP_ENV=production
   railway variables set APP_DEBUG=false
   # ... add all other variables
   ```

5. **Deploy**
   ```bash
   railway up
   ```

---

## Post-Deployment Configuration

### 1. Update Frontend API URL

After Railway backend is deployed, update Vercel environment:

```bash
# Via Vercel Dashboard
# Settings → Environment Variables → VITE_API_BASE_URL
# Set to: https://your-railway-backend.railway.app/api

# Or via CLI
vercel env add VITE_API_BASE_URL production
# Enter your Railway URL when prompted

# Redeploy frontend
vercel --prod
```

### 2. Configure CORS in Backend

Update `config/cors.php` if needed:

```php
'allowed_origins' => [
    env('FRONTEND_URL', 'http://localhost:5173'),
    'https://*.vercel.app',
],
```

### 3. Create Admin User

```bash
# Via Railway CLI
railway run php artisan tinker

# Then in tinker:
$user = new App\Models\User();
$user->username = 'admin';
$user->email = 'admin@example.com';
$user->password = bcrypt('your-secure-password');
$user->role = 'admin';
$user->is_active = true;
$user->save();
exit
```

---

## Important Notes

### File Storage

- Railway uses ephemeral storage (files deleted on redeploy)
- For production, configure S3 or Cloudinary:
  ```bash
  railway variables set FILESYSTEM_DISK=s3
  railway variables set AWS_ACCESS_KEY_ID=your-key
  railway variables set AWS_SECRET_ACCESS_KEY=your-secret
  railway variables set AWS_DEFAULT_REGION=us-east-1
  railway variables set AWS_BUCKET=your-bucket
  ```

### Database Backups

- Railway Pro includes automatic backups
- Manual backup:
  ```bash
  railway run pg_dump $DATABASE_URL > backup.sql
  ```

### Monitoring

- Railway: Dashboard → Metrics tab
- Vercel: Dashboard → Analytics tab

### Custom Domains

- **Vercel**: Settings → Domains → Add domain
- **Railway**: Settings → Domains → Add domain

### SSL Certificates

- Both Vercel and Railway provide free SSL automatically

---

## Troubleshooting

### Frontend Issues

**Problem:** API calls failing

- Check VITE_API_BASE_URL is correct in Vercel env vars
- Verify CORS settings in backend
- Check browser console for errors

**Problem:** Assets not loading

- Verify `base` in vite.config.js
- Check public folder structure

### Backend Issues

**Problem:** 500 errors

- Check Railway logs: `railway logs`
- Verify all env variables are set
- Check database connection

**Problem:** Migrations failing

- Check DATABASE_URL format
- Verify PostgreSQL is running
- Check migration files for errors

**Problem:** CORS errors

- Verify FRONTEND_URL in Railway env
- Check SANCTUM_STATEFUL_DOMAINS
- Update cors.php allowed_origins

### Database Issues

**Problem:** Connection timeout

- Check DATABASE_URL format
- Verify PostgreSQL service is running in Railway
- Check DB credentials

---

## Quick Commands Reference

### Vercel

```bash
vercel                    # Deploy to preview
vercel --prod            # Deploy to production
vercel logs              # View logs
vercel env ls            # List environment variables
vercel env pull          # Pull environment variables locally
```

### Railway

```bash
railway up               # Deploy
railway logs             # View logs
railway run <command>    # Run command in production
railway variables        # List environment variables
railway open             # Open project in browser
railway status           # Check deployment status
```

---

## Cost Estimates

### Vercel (Free Tier)

- ✅ Suitable for testing/demo
- ✅ 100GB bandwidth/month
- ✅ Unlimited deployments
- ⚠️ Upgrade to Pro ($20/month) for production

### Railway (Free Tier)

- ⚠️ $5 credit/month (limited)
- ⚠️ Upgrade to Developer ($10/month) or Pro ($20/month) recommended
- PostgreSQL included

**Recommended for Production:**

- Vercel Pro: $20/month
- Railway Pro: $20/month
- **Total: ~$40/month**

---

## Security Checklist

- [ ] APP_DEBUG=false in production
- [ ] Strong APP_KEY generated
- [ ] Database credentials secured
- [ ] CORS properly configured
- [ ] Rate limiting enabled
- [ ] HTTPS enforced
- [ ] Environment variables set correctly
- [ ] Admin password changed
- [ ] File permissions verified
- [ ] Error logging configured

---

## Support Resources

- Vercel Docs: https://vercel.com/docs
- Railway Docs: https://docs.railway.app
- Laravel Deployment: https://laravel.com/docs/10.x/deployment
- Vite Deployment: https://vitejs.dev/guide/static-deploy.html
